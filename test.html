<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NiniÂ´s Geburtstagsquiz ðŸ¥³</title>
  <!-- Confetti Library -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js" defer></script>
  <!-- SortableJS for touch-friendly drag & drop -->
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js" defer></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; }
    body { margin: 0; padding: 0; background: #121212; color: #e0e0e0; font-family: Arial, sans-serif; }
    .wave { position: absolute; left: 50%; bottom: 0; width: 200%; height: 100px; background: rgba(255,255,255,0.05); border-radius: 40% 50%; transform: translateX(-50%); animation: waveAnim 6s infinite linear; pointer-events: none; }
    .wave:nth-of-type(2) { animation-duration: 8s; opacity: 0.7; }
    @keyframes waveAnim { 0% { transform: translateX(-50%) translateY(0); } 50% { transform: translateX(-50%) translateY(-20px); } 100% { transform: translateX(-50%) translateY(0); } }
    #app { position: relative; z-index: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; padding: 1rem; }
    .card { position: relative; background: #1e1e1e; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.5); width: 100%; max-width: 480px; margin-bottom: 1rem; text-align: center; }
    h1 { font-size: 1.5rem; margin: 0.5rem 0; }
    p, li { font-size: 1rem; margin: 0.5rem 0; }
    p.hint { font-size: 0.85rem; color: #aaa; }
    input[type="text"], input[type="password"] { width: 100%; padding: 0.75rem; margin: 0.5rem 0; background: #2e2e2e; color: #e0e0e0; border: 1px solid #555; border-radius: 4px; font-size: 1rem; }
    input:focus { box-shadow: 0 0 5px #1DB954; }
    button { background: #1DB954; color: #fff; border: none; padding: 0.75rem; font-size: 1rem; border-radius: 4px; cursor: pointer; margin: 0.5rem 0; width: 100%; }
    button:hover { background: #17a74a; }
    .option-btn { background: #333; color: #e0e0e0; margin: 0.25rem 0; padding: 0.75rem; border-radius: 4px; text-align: left; width: 100%; border: none; cursor: pointer; }
    .option-btn:hover { background: #444; }
    .timer-container { position: absolute; top: 0; left: 0; width: 100%; height: 6px; background: #444; border-top-left-radius: 8px; border-top-right-radius: 8px; overflow: hidden; }
    .timer-bar { width: 100%; height: 100%; background: #1DB954; }
    @keyframes shrink { from { width: 100%; } to { width: 0%; } }
    #feedback { position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: none; justify-content: center; align-items: center; background: rgba(0,0,0,0.5); color: #fff; font-size: 2rem; font-weight: bold; z-index: 2000; }
    .fade-in { animation: fadeIn 0.5s ease-out; }
    .fade-out { animation: fadeOut 0.5s ease-out forwards; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
    #clue, #final-message { display: none; }
    /* Tierlist layout */
    .tier-zones { display: grid; grid-template-columns: repeat(5,1fr); gap: 0.5rem; margin: 1rem 0; }
    .zone { border: 1px dashed #555; border-radius: 4px; padding: 0.5rem; min-height: 100px; }
    .tier-zones .zone:nth-child(1) { background: rgb(239,134,131); }
    .tier-zones .zone:nth-child(2) { background: rgb(245,194,136); }
    .tier-zones .zone:nth-child(3) { background: rgb(250,224,140); }
    .tier-zones .zone:nth-child(4) { background: rgb(255,255,145); }
    .tier-zones .zone:nth-child(5) { background: rgb(203,251,142); }
    .zone h3 { margin: 0 0 0.5rem; font-size: 1rem; color: #000; }
    .zone-list { list-style: none; padding: 0; margin: 0; display: flex; flex-direction: column; align-items: center; gap: 0.25rem; }
    .pool-list { display: flex; flex-wrap: wrap; justify-content: center; gap: 0.25rem; padding: 0.25rem 0; margin: 0 auto; max-width: 480px; }
    .tier-item { background: #444; color: #fff; display: inline-block; max-width: 90%; margin: 0.25rem; padding: 0.75rem 1rem; border-radius: 8px; cursor: grab; box-shadow: 0 2px 6px rgba(0,0,0,0.5); transition: transform 0.2s, background 0.2s; word-break: break-word; text-align: center; }
    .tier-item:active { transform: scale(1.05); background: #555; }
  </style>
</head>
<body>
  <div class="wave"></div><div class="wave"></div>
  <canvas id="confetti-canvas" style="position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;display:none;z-index:1500;"></canvas>
  <div id="feedback"></div>
  <div id="app">
    <div id="loginDiv" class="card">
      <h1>NiniÂ´s Geburtstagsquiz ðŸ¥³</h1>
      <p>Bitte Passwort eingeben:</p>
      <input type="password" id="passwordInput" placeholder="Passwort">
      <p class="hint">Bitte nicht googeln...</p>
      <button id="loginBtn">Einloggen</button>
    </div>
    <div id="clue" class="card">
      <div class="timer-container"><div id="timer-bar" class="timer-bar"></div></div>
      <h1>Frage <span id="step-number">0</span> von <span id="total-steps">0</span></h1>
      <img id="clockImg" src="https://i.imgur.com/iHs5Ot5.png" style="width:100%;max-width:300px;margin:0.5rem auto;display:none;">
      <p id="clue-text"></p>
      <div id="options-container"></div>
      <div id="tierlist-ui"></div>
      <input type="text" id="answerInput" style="display:none;">
      <button id="answerBtn" style="display:none;">ÃœberprÃ¼fen</button>
      <button id="restartBtn">Quiz neu starten</button>
    </div>
    <div id="final-message" class="card">
      <h1>Herzlichen GlÃ¼ckwunsch!</h1>
      <p>Alles Gute zum Geburtstag, Nini! ðŸŽ‰</p>
      <p>Du hast dein Geschenk entdeckt: Zugang zum <strong>Spotify Duo Abo</strong></p>
      <p>Schreib mir einfach deine E-Mail!</p>
      <button id="restartBtn">Quiz neu starten</button>
    </div>
  </div>
  <script defer>
    document.addEventListener('DOMContentLoaded', () => {
      const loginDiv = document.getElementById('loginDiv');
      const clueDiv = document.getElementById('clue');
      const finalDiv = document.getElementById('final-message');
      const feedback = document.getElementById('feedback');
      const loginBtn = document.getElementById('loginBtn');
      const restartBtns = document.querySelectorAll('#restartBtn');
      const clueText = document.getElementById('clue-text');
      const optsDiv = document.getElementById('options-container');
      const uiDiv = document.getElementById('tierlist-ui');
      const answerInput = document.getElementById('answerInput');
      const answerBtn = document.getElementById('answerBtn');
      const stepNum = document.getElementById('step-number');
      const totalSteps = document.getElementById('total-steps');
      const clockImg = document.getElementById('clockImg');
      const pwdInput = document.getElementById('passwordInput');
      const confettiCanvas = document.getElementById('confetti-canvas');
      let confettiFn = () => {};
      if (window.confetti && typeof window.confetti.create === 'function') {
        confettiFn = window.confetti.create(confettiCanvas, { resize: true });
      }
      let endTimer;
      let step = 0;

      function showFeedback(msg, ok = true) {
        feedback.textContent = msg;
        feedback.style.backgroundColor = ok ? 'rgba(0,128,0,0.8)' : 'rgba(255,0,0,0.8)';
        feedback.classList.remove('fade-in', 'fade-out'); void feedback.offsetWidth;
        feedback.classList.add('fade-in'); feedback.style.display = 'flex';
        setTimeout(() => {
          feedback.classList.remove('fade-in'); void feedback.offsetWidth;
          feedback.classList.add('fade-out');
          setTimeout(() => feedback.style.display = 'none', 500);
        }, 1000);
      }

      function startTimer(enable = true) {
        clearTimeout(endTimer);
        const bar = document.getElementById('timer-bar');
        bar.style.animation = 'none'; void bar.offsetWidth;
        if (!enable) return;
        bar.style.animation = 'shrink 10s linear forwards';
        endTimer = setTimeout(() => {
          pauseTimer();
          showFeedback('Zeit abgelaufen! Neustart!', false);
          setTimeout(() => { step = 0; showClue(); }, 1000);
        }, 10000);
      }

      function pauseTimer() { const bar = document.getElementById('timer-bar'); bar.style.animationPlayState = 'paused'; clearTimeout(endTimer); }
      function resumeTimer() { const bar = document.getElementById('timer-bar'); bar.style.animationPlayState = 'running'; }

      const SECRET = '123';
      const clues = [
        { text: 'Welche Uhrzeit zeigt diese Uhr an? (HH:MM:SS)', type: 'text', check: ans => ans.trim() === '10:22:40' },
        { text: 'Wie heiÃŸt BoyWithUkes berÃ¼hmtester Song?', type: 'text', check: ans => ans.trim().toLowerCase() === 'toxic' },
        { text: 'Wie viele Herzen hat ein Oktopus?', type: 'text', check: ans => ans.trim() === '3' },
        { text: 'Sub Urban ist bekannt fÃ¼r seinen...', type: 'mc', options: ['experimentellen Sound', 'Gitarrenstil', 'Country-Vibe', 'YouTube-Vlogs'], answer: 'experimentellen sound' },
        { text: 'Wann habe ich dir das erste Mal geschrieben?', type: 'mc', options: ['29. Mai 2024', '25. Juli 2024', '05. Juli 2024', '02. Juni 2024'], answer: '05. juli 2024' },
        { text: 'Was ist das Ziel dieses Quizzes?', type: 'text', check: ans => /(geschenk|geburtstag|geburtstagsgeschenk)/i.test(ans.trim().toLowerCase()) },
        { text: 'BoyWithUkes Musikstil ist eine Mischung ausâ€¦?', type: 'mc', options: ['Indie + Lo-Fi + Pop', 'Techno + Schlager', 'Rock + Rap', 'Jazz + Country'], answer: 'indie + lo-fi + pop' },
        { text: 'Wie alt wirst du?', type: 'text', check: ans => ans.trim() === '19' },
        { text: 'Was ist oft Thema in Sub Urbans Musikvideos?', type: 'mc', options: ['Strand und Sonne', 'Surreale / dÃ¼stere Bilder', 'Autos und Geld', 'Katzen in AnzÃ¼gen'], answer: 'surreale / dÃ¼stere bilder' },
        { text: 'Wie oft haben wir schon gecallt?', type: 'text', check: ans => ans.trim() === '1' },
        { text: 'Wie heiÃŸt Sub Urbans bÃ¼rgerlicher Name?', type: 'text', check: ans => ans.trim().toLowerCase().startsWith('daniel') },
        { text: 'Auf welcher Plattform hat BoyWithUke zuerst an PopularitÃ¤t gewonnen?', type: 'mc', options: ['TikTok', 'YouTube', 'SoundCloud', 'Instagram'], answer: 'tiktok' },
        { text: 'In welchem Jahr wurde Spotify offiziell gestartet?', type: 'text', check: ans => ans.trim() === '2008' },
        { text: 'Wie teuer ist Spotify Premium?', type: 'text', check: ans => /^(10[.,]?99â‚¬?|11â‚¬?|elf)$/i.test(ans.trim()) },
        { text: 'Wie hieÃŸ meine erste Katze?', type: 'mc', options: ['Liza', 'Lina', 'Lanna', 'Lana'], answer: 'liza' },
        { text: 'Sortiere die Top 5 BoyWithUke Songs in die richtige Reihenfolge (Drag & Drop)', type: 'tier', items: ['Toxic', 'IDGAF (feat. blackbear)', 'Two Moons', 'Understand', 'Long Drives'] },
        { text: 'AHHHHHHHHHHHHHHH', type: 'text', check: ans => ans.trim().toUpperCase() === 'AHHHHHHHHHHHHHHH' }
      ];
      totalSteps.textContent = clues.length;

      loginBtn.addEventListener('click', () => {
        if (pwdInput.value === SECRET) {
          loginDiv.style.display = 'none';
          showClue();
        } else {
          showFeedback('FALSCH!', false);
        }
      });

      restartBtns.forEach(btn => btn.addEventListener('click', () => {
        pauseTimer();
        step = 0;
        showClue();
      }));

      function showClue() {
        finalDiv.style.display = 'none';
        confettiCanvas.style.display = 'none';
        pauseTimer();
        optsDiv.innerHTML = '';
        uiDiv.innerHTML = '';
        answerInput.value = '';
        clockImg.style.display = 'none';
        answerInput.style.display = 'none';
        answerBtn.style.display = 'none';

        if (step >= clues.length) {
          clueDiv.style.display = 'none';
          finalDiv.style.display = 'block';
          confettiCanvas.style.display = 'block';
          confettiFn({ particleCount: 200, spread: 70, origin: { y: 0.6 } });
          return;
        }

        const c = clues[step];
        clueDiv.style.display = 'block';
        stepNum.textContent = step + 1;
        totalSteps.textContent = clues.length;
        clueText.textContent = c.text;

        if (c.type === 'mc') {
          c.options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.textContent = opt;
            btn.addEventListener('click', () => {
              pauseTimer();
              if (opt.toLowerCase() === c.answer) {
                showFeedback('RICHTIG!');
                setTimeout(() => { step++; showClue(); }, 1000);
              } else {
                showFeedback('FALSCH!', false);
                setTimeout(resumeTimer, 1000);
              }
            });
            optsDiv.appendChild(btn);
          });
          startTimer(true);
        } else if (c.type === 'text') {
          clockImg.style.display = step === 0 ? 'block' : 'none';
          answerInput.style.display = 'block';
          answerInput.placeholder = step === 0 ? '00:00:00' : '';
          answerBtn.style.display = 'block';
          startTimer(true);
        } else if (c.type === 'tier') {
          startTimer(false);
          const zones = ['S', 'A', 'B', 'C', 'D'];
          const container = document.createElement('div'); container.className = 'tier-zones';
          zones.forEach(z => {
            const zone = document.createElement('div'); zone.className = 'zone';
            const h = document.createElement('h3'); h.textContent = z;
            const ul = document.createElement('ul'); ul.id = 'zone-' + z; ul.className = 'zone-list';
            ul.addEventListener('dragover', e => e.preventDefault());
            ul.addEventListener('drop', e => {
              e.preventDefault();
              const id = e.dataTransfer.getData('text/plain');
              const li = document.getElementById(id);
              if (li) ul.appendChild(li);
            });
            zone.append(h, ul);
            // Allow dropping anywhere in zone div
            zone.addEventListener('dragover', e => e.preventDefault());
            zone.addEventListener('drop', e => {
              e.preventDefault();
              const id = e.dataTransfer.getData('text/plain');
              const li = document.getElementById(id);
              if (li) ul.appendChild(li);
            });
            container.append(zone);
          });

          const poolDiv = document.createElement('div'); poolDiv.className = 'pool';
          const pul = document.createElement('ul'); pul.className = 'pool-list';
          // Append the list to the pool container
          poolDiv.appendChild(pul);

          const items = [...c.items]; items.sort(() => Math.random() - 0.5);
          items.slice(0, 2).forEach((it, i) => {
            const li = document.createElement('li');
            li.textContent = it; li.className = 'tier-item'; li.id = 'item-' + i;
            li.draggable = true;
            li.addEventListener('dragstart', e => e.dataTransfer.setData('text/plain', li.id));
            pul.appendChild(li);
          });
          items.slice(2).forEach((it, i) => {
            const li = document.createElement('li');
            li.textContent = it; li.className = 'tier-item'; li.id = 'item-' + (i + 2);
            li.draggable = true;
            li.addEventListener('dragstart', e => e.dataTransfer.setData('text/plain', li.id));
            pul.appendChild(li);
          });

          uiDiv.append(container);
          uiDiv.append(poolDiv);
          // Initialize touch-friendly drag & drop
          const zoneLists = [...uiDiv.querySelectorAll('.zone-list')];
          zoneLists.forEach(ul => Sortable.create(ul, { group: 'tier', animation: 150 }));
          Sortable.create(uiDiv.querySelector('.pool-list'), { group: 'tier', animation: 150 });
          answerBtn.style.display = 'block';
        }
      }

      answerBtn.addEventListener('click', () => {
        const c = clues[step];
        if (c.type === 'text') {
          pauseTimer();
          if (c.check(answerInput.value)) {
            showFeedback('RICHTIG!');
            setTimeout(() => { step++; showClue(); }, 1000);
          } else {
            showFeedback('FALSCH!', false);
            setTimeout(resumeTimer, 1000);
          }
        } else if (c.type === 'tier') {
          const order = [];
          ['S', 'A', 'B', 'C', 'D'].forEach(z => {
            const ul = document.getElementById('zone-' + z);
            Array.from(ul.children).forEach(li => order.push(li.textContent));
          });
          if (JSON.stringify(order) === JSON.stringify(c.items)) {
            showFeedback('RICHTIG!');
            setTimeout(() => { step++; showClue(); }, 1000);
          } else {
            showFeedback('FALSCH!', false);
            setTimeout(() => { showClue(); }, 1000);
          }
        }
      });
    });
  </script>
</body>
</html>
